var U=function(P){throw Error(P)},d=function(P){return $.href=chrome.runtime.getURL("/_favicon/"),$.searchParams.set("pageUrl",P),$.searchParams.set("size","16"),$.toString()},F=function(P,v){if(X.url=P,X.active=Q.focusTabs,Q.open==="0"===!v)chrome.tabs.update(V.id,X,void 0);else chrome.tabs.create(X,void 0)},I=function(P){const j=_.templateRange.content.cloneNode(!0).firstElementChild,Y=j.firstElementChild,z=Y.firstElementChild,G=b.format(P);z.textContent=G;const W=Y.lastElementChild;if(J.mode==="d")W.title=`Remove all browsing history form ${G}`,W.setAttribute("data-range",String(P)),W.appendChild(_.templateIconDelete.content.cloneNode(!0));else W.setAttribute("data-display","0");return j},x=function(P,v){var j=_.templateItem.content.cloneNode(!0),Y=j.firstElementChild;Y.href=P.url,Y.title=P.title+"\n"+P.url;var z=Y.children,G=z[0];if(P.url===void 0)U("hitem.url is undefined");G.src=d(P.url);var W=z[1];if(P.title==="")W.textContent=P.url;else W.textContent=P.title;var B=z[2],H=B.firstElementChild;H.setAttribute("data-url",P.url),H.setAttribute("data-range",String(v)),H.appendChild(_.templateIconDelete.content.cloneNode(!0));var y=B.lastElementChild;return y.textContent=E.format(P.lastVisitTime),Y},k=function(P){if(P.length<1||P.length===1&&P[0].id===J.lastItemId){console.info("No more History"),J.historyFinished=!0,_.loading.setAttribute("data-display","0");return}var v,j;if(q.length>0)v=_.container.lastElementChild,_.fragment.appendChild(v),j=q.getIndex(N.start);var Y,z=0;if(P[0].id===J.lastItemId)z=1;while(z<P.length){var G=P[z];if(Y=G.lastVisitTime,Y===void 0)U("hitem.lastVisitTime is undefined");if(N.start>Y)N.update(Y),j=q.set(N.end,N.start),v=I(N.start),_.fragment.appendChild(v);if(j===void 0)U("rangeIndex is undefind");J.lastItemId=G.id,J.totalItems+=1,q.addCount(j);const W=x(G,N.start);v.appendChild(W),z+=1}if(Y!==void 0)Z.endTime=Y,_.container.appendChild(_.fragment);_.loading.setAttribute("data-display","0")},K=function(P){if(k(P),J.totalItems<1){_.noHistory.setAttribute("data-display","1");return}_.noHistory.setAttribute("data-display","0")},A=function(){if(J.totalItems<1){_.noHistory.setAttribute("data-display","1");return}if(!J.historyFinished&&_.container.clientHeight===_.container.scrollHeight)chrome.history.search(Z,K)},u=function(P){var{open:v,focusTabs:j,theme:Y}=P,z=!1;if(v===void 0)z=!0;else Q.open=v,_.modalConfigOpen.value=v;if(j===void 0)z=!0;else Q.focusTabs=j,_.modalConfigFocus.checked=j;if(Y===void 0)z=!0;else Q.theme=Y,document.firstElementChild?.setAttribute("class",Y);if(z)chrome.storage.local.set(Q,void 0)},c=function(P,v){if(P==="0"){const j=v.getAttribute("data-url"),Y=v.getAttribute("data-range");if(j===null||Y===null)return;const z=v.parentElement.parentElement;f.url=j,chrome.history.deleteUrl(f,void 0);const G=q.getIndex(Number(Y));if(G<0)return;if(q.subtractCount(G),q.count[G]<1)z.parentElement.remove(),q.remove(G);else z.remove();J.totalItems-=1,A()}else if(P==="1"){const j=v.getAttribute("data-range");if(j===null)return;const Y=q.getIndex(Number(j));if(Y<0)return;let z=q.end[Y],G=q.start[Y],W=q.count[Y];J.totalItems-=W,L.endTime=z,L.startTime=G,chrome.history.deleteRange(L),v.parentElement.parentElement.remove(),q.remove(Y),A()}},p=function(P){if(J.historyFinished)return;const v=P.currentTarget;if(v.scrollTop>=v.scrollHeight-v.clientHeight-50)_.loading.setAttribute("data-display","1"),chrome.history.search(Z,k)},R=function(P){Z.text=P.value,Z.endTime=Date.now(),_.loading.setAttribute("data-display","1"),J.reset(),q.reset(),N.reset(),_.container.replaceChildren(),chrome.history.search(Z,K),w=void 0},C=function(){if(_.inputSearch.value.length===0)_.buttonSearch.setAttribute("data-display","0"),J.mode="d";else _.buttonSearch.setAttribute("data-display","1"),J.mode="s";if(w!==void 0)clearTimeout(w);w=setTimeout(R,500,_.inputSearch),_.loading.setAttribute("data-display","1")},T=function(P){var v=P.target,j=v.getAttribute("data-button");if(j==="0")F("chrome://history",!1);else if(j==="1")X.url="chrome://settings/clearBrowserData",X.active=!0,chrome.tabs.create(X,void 0);else if(j==="2")_.modalConfig?.setAttribute("data-display","1");else if(j==="3")window.close()},l=function(){_.inputSearch.value="",C()},h=function(P){var v=P.target,j=v.getAttribute("data-type");if(j==="0"){P.preventDefault();var Y=v.getAttribute("href");X.url=Y,X.active=Q.focusTabs,chrome.tabs.create(X,void 0)}},o=function(P){var v=P.target,j=v.getAttribute("data-type");if(j==="2"){const Y=v.getAttribute("data-parent");c(Y,v),P.preventDefault();return}if(j==="0"){if(!P.shiftKey){const Y=v.href;F(Y,P.ctrlKey),P.preventDefault()}}},S=function(P){var v=P.target,j=v.getAttribute("data-type");if(j=="3"||j==="2")_.modalConfig?.setAttribute("data-display","0")},g=function(P){var v=P.currentTarget;Q.theme=v.value,document.firstElementChild?.setAttribute("class",v.value),chrome.storage.local.set(Q,void 0)},s=function(P){var v=P.currentTarget;Q.open=v.value,chrome.storage.local.set(Q,void 0)},m=function(P){var v=P.currentTarget;Q.focusTabs=v.checked,chrome.storage.local.set(Q,void 0)},M=function(P){V=P[0],chrome.history.search(Z,K)},r=function(){if(_.loading=document.getElementById("loading"),_.loading===null)throw Error("DOM.loading is null");if(_.headerButtons=document.getElementById("header_buttons"),_.headerButtons===null)throw Error("DOM.headerButtons is null");if(_.inputSearch=document.getElementById("input_search"),_.inputSearch===null)throw Error("DOM.inputSearch is null");if(_.buttonSearch=document.getElementById("button_search"),_.buttonSearch===null)throw Error("DOM.buttonSearch is null");if(_.noHistory=document.getElementById("no-history"),_.noHistory===null)throw Error("DOM.noHistory is null");if(_.container=document.getElementById("container"),_.container===null)throw Error("DOM.container is null");if(_.modalConfig=document.getElementById("modal_config"),_.modalConfig===null)throw Error("DOM.modalConfig is null");if(_.modalConfigTheme=document.getElementById("modal_config-theme"),_.modalConfigTheme===null)throw Error("DOM.modalConfigTheme is null");if(_.modalConfigOpen=document.getElementById("modal_config-open"),_.modalConfigOpen===null)throw Error("DOM.modalConfigOpen is null");if(_.modalConfigFocus=document.getElementById("modal_config-focus"),_.modalConfigFocus===null)throw Error("DOM.modalConfigFocus is null");if(_.templateRange=document.getElementById("template_range"),_.templateRange===null)throw Error("DOM.templateRange is null");if(_.templateItem=document.getElementById("template_item"),_.templateItem===null)throw Error("DOM.templateItem is null");if(_.templateIconDelete=document.getElementById("template_icon-delete"),_.templateIconDelete===null)throw Error("DOM.templateIconDelete is null");_.headerButtons.onclick=T,_.inputSearch.oninput=C,_.buttonSearch.onclick=l,_.container.onscroll=p,_.container.onclick=o,_.container.onauxclick=h,_.modalConfig.onclick=S,_.modalConfigTheme.onchange=g,_.modalConfigOpen.onchange=s,_.modalConfigFocus.onchange=m,chrome.storage.local.get(void 0,u),chrome.tabs.query({active:!0,currentWindow:!0},M)};var E=Intl.DateTimeFormat(void 0,{timeStyle:"short"}),b=Intl.DateTimeFormat(void 0,{dateStyle:"full"}),_={container:null,inputSearch:null,headerButtons:null,buttonSearch:null,noHistory:null,loading:null,modalConfig:null,modalConfigTheme:null,modalConfigOpen:null,modalConfigFocus:null,templateItem:null,templateRange:null,templateIconDelete:null,fragment:document.createDocumentFragment()},Q={focusTabs:!1,open:"0",theme:"dark"},J={MIN_SEARCDOM_RESULTS:30,lastItemId:"",totalItems:0,historyFinished:!1,mode:"d",reset(){J.lastItemId="",J.totalItems=0,J.historyFinished=!1}},V=void 0,Z={text:"",maxResults:J.MIN_SEARCDOM_RESULTS,startTime:0,endTime:Date.now()},N={OFFSET:60000*(new Date()).getTimezoneOffset(),start:Z.endTime,end:Z.endTime,update(P){N.end=N.start,N.start=P-(P-N.OFFSET)%86400000},reset(){var P=Date.now();N.end=P,N.start=P}},q={end:[],start:[],count:[],length:0,addCount(P){const v=q.count;if(P<0||v.length<=P)return!1;return v[P]+=1,!0},getIndex(P){var v=q.start,j=v.length;if(j<5)return v.indexOf(P);var Y=0,z=0,G=0;while(Y<j)if(z=Y+Math.floor((j-Y)/2),G=v[z],P===G)return z;else if(G<P)j=z;else Y=z+1;return-1},remove(P){var v=q.length;if(P<0||v<=P)return!1;return q.end.copyWithin(P,P+1,v),q.end.pop(),q.start.copyWithin(P,P+1,v),q.start.pop(),q.count.copyWithin(P,P+1,v),q.count.pop(),q.length-=1,!0},reset(){q.end.length=0,q.start.length=0,q.count.length=0,q.length=0},set(P,v){return q.end.push(P),q.start.push(v),q.count.push(0),q.length+=1,q.length-1},subtractCount(P){const v=q.count;if(P<0||v.length<=P)return!1;if(v[P]>0)v[P]-=1;return!0}},$=new URL("http://t.i"),X={active:!1,url:""},f={url:""},L={endTime:0,startTime:0},w=void 0;window.addEventListener("DOMContentLoaded",r);
