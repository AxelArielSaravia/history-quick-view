var S=function(_){return N.href=chrome.runtime.getURL("/_favicon/"),N.searchParams.set("pageUrl",_),N.searchParams.set("size","16"),N.toString()},O=function(_){const v=o.content.cloneNode(!0).firstElementChild,j=v.firstElementChild,z=j.firstElementChild,G=I.format(_);z.textContent=G;const Q=j.lastElementChild;if(J.mode==="d")Q.title=`Remove all browsing history form ${G}`,Q.setAttribute("data-range",String(_)),Q.appendChild(d.content.cloneNode(!0));else Q.setAttribute("data-display","0");return v},D=function(_,Y){var v=g.content.cloneNode(!0),j=v.firstElementChild;j.href=_.url,j.title=_.title+"\n"+_.url;var z=j.children,G=z[0];G.src=S(_.url);var Q=z[1];if(_.title==="")Q.textContent=_.url;else Q.textContent=_.title;var K=z[2],V=K.firstElementChild;V.setAttribute("data-url",_.url),V.setAttribute("data-range",String(Y)),V.appendChild(d.content.cloneNode(!0));var h=K.lastElementChild;return h.textContent=l.format(_.lastVisitTime),j},c=function(_){if(_.length<1||_.length===1&&_[0].id===J.lastItemId){console.info("No more History"),J.historyFinished=!0,w.setAttribute("data-display","0");return}var Y,v;if(q.length>0)Y=$.lastElementChild,B.appendChild(Y),v=q.getIndex(P.start);var j,z=0;if(_[0].id===J.lastItemId)z=1;while(z<_.length){var G=_[z];if(j=G.lastVisitTime,P.start>j)P.update(j),v=q.set(P.end,P.start),Y=O(P.start),B.appendChild(Y);J.lastItemId=G.id,J.totalItems+=1,q.addCount(v);const Q=D(G,P.start);Y.appendChild(Q),z+=1}if(j!==void 0)X.endTime=j,$.appendChild(B);w.setAttribute("data-display","0")},b=function(_){if(c(_),J.totalItems<1){f.setAttribute("data-display","1");return}f.setAttribute("data-display","0")},C=function(){if(J.totalItems<1){f.setAttribute("data-display","1");return}if(!J.historyFinished&&$.clientHeight===$.scrollHeight)chrome.history.search(X,b)},i=function(_,Y){if(_==="h-item"){const v=Y.getAttribute("data-url"),j=Y.getAttribute("data-range");if(v===null||j===null)return;const z=Y.parentElement.parentElement;E.url=v,chrome.history.deleteUrl(E);const G=q.getIndex(Number(j));if(G<0)return;if(q.subtractCount(G),q.count[G]<1)z.parentElement.remove(),q.remove(G);else z.remove();J.totalItems-=1,C()}else if(_==="h-date"){const v=Y.getAttribute("data-range");if(v===null)return;const j=q.getIndex(Number(v));if(j<0)return;let z=q.end[j],G=q.start[j],Q=q.count[j];J.totalItems-=Q,A.endTime=z,A.startTime=G,chrome.history.deleteRange(A),Y.parentElement.parentElement.remove(),q.remove(j),C()}},r=function(_){if(J.historyFinished)return;const Y=_.currentTarget;if(Y.scrollTop===Y.scrollHeight-Y.clientHeight)w.setAttribute("data-display","1"),chrome.history.search(X,c)},n=function(_){X.text=_.value,X.endTime=Date.now(),w.setAttribute("data-display","1"),J.reset(),q.reset(),P.reset(),$.replaceChildren(),chrome.history.search(X,b),U=void 0},T=function(){if(k.value.length===0)F.setAttribute("data-display","0"),J.mode="d";else F.setAttribute("data-display","1"),J.mode="s";if(U!==void 0)clearTimeout(U);U=setTimeout(n,500,k),w.setAttribute("data-display","1")},R=function(_,Y){if(Z.url=_,Z.active=W.focusTabs!=="0",W.open==="0"===!Y)chrome.tabs.update(p.id,Z);else chrome.tabs.create(Z)};var l=Intl.DateTimeFormat(void 0,{timeStyle:"short"}),I=Intl.DateTimeFormat(void 0,{dateStyle:"full"}),$=document.getElementById("h-container"),k=document.getElementById("h-input-search"),F=document.getElementById("h-button-search"),H=document.getElementById("h-button-history"),M=document.getElementById("h-button-clean"),m=document.getElementById("h-button-more"),f=document.getElementById("h-no-history"),w=document.getElementById("h-loading"),y=document.getElementById("h-modal"),x=document.getElementById("h-config-open"),u=document.getElementById("h-config-focus"),g=document.getElementById("template_h-item"),o=document.getElementById("template_h-range"),d=document.getElementById("template_h-delete-icon"),B=document.createDocumentFragment(),s={indexOf(_,Y){var v=_.length;if(v<5)return _.indexOf(Y);var j=0,z=0,G=0;while(j<v)if(z=j+Math.floor((v-j)/2),G=_[z],Y===G)return z;else if(G<Y)v=z;else j=z+1;return-1}},W={focusTabs:"0",open:"0"},J={MIN_SEARCH_RESULTS:30,lastItemId:"",totalItems:0,historyFinished:!1,mode:"d",reset(){J.lastItemId="",J.totalItems=0,J.historyFinished=!1}},p=void 0,X={text:"",maxResults:J.MIN_SEARCH_RESULTS,startTime:0,endTime:Date.now()},P={OFFSET:60000*(new Date()).getTimezoneOffset(),start:X.endTime,end:X.endTime,update(_){P.end=P.start,P.start=_-(_-P.OFFSET)%86400000},reset(){var _=Date.now();P.end=_,P.start=_}},q={end:[],start:[],count:[],length:0,addCount(_){const Y=q.count;if(_<0||Y.length<=_)return!1;return Y[_]+=1,!0},getIndex(_){return s.indexOf(q.start,_)},remove(_){var Y=q.length;if(_<0||Y<=_)return!1;return q.end.copyWithin(_,_+1,Y),q.end.pop(),q.start.copyWithin(_,_+1,Y),q.start.pop(),q.count.copyWithin(_,_+1,Y),q.count.pop(),q.length-=1,!0},reset(){q.end.length=0,q.start.length=0,q.count.length=0,q.length=0},set(_,Y){return q.end.push(_),q.start.push(Y),q.count.push(0),q.length+=1,q.length-1},subtractCount(_){const Y=q.count;if(_<0||Y.length<=_)return!1;if(Y[_]>0)Y[_]-=1;return!0}},N=new URL("http://t.i"),E={url:""},A={endTime:0,startTime:0},U=void 0,Z={active:!1,url:""};k.oninput=T;F.onclick=function(){k.value="",T()};var L=!1;m.onclick=function(){if(L)y.setAttribute("data-display","0");else y.setAttribute("data-display","1");L=!L};x.onchange=function(_){var Y=_.currentTarget;W.open=Y.value,chrome.storage.local.set(W)};u.onchange=function(_){var Y=_.currentTarget;W.focusTabs=Y.value,chrome.storage.local.set(W)};$.onscroll=r;M.onclick=function(){Z.url="chrome://settings/clearBrowserData",Z.active=!0,chrome.tabs.create(Z)};H.onclick=function(){R("chrome://history",!1)};$.onclick=function(_){var Y=_.target,v=Y.getAttribute("data-class");if(v==="h-remove"||Y.matches("[data-class=h-remove] *")){const j=Y.closest("[data-class=h-remove]"),z=j.getAttribute("data-type");i(z,j),_.preventDefault();return}if(v==="h-item"||Y.matches("[data-class=h-item] *")){if(!_.shiftKey){const z=Y.closest("[data-class=h-item]").href;R(z,_.ctrlKey),_.preventDefault()}}};chrome.storage.local.get(void 0,function(_){var{open:Y,focusTabs:v}=_,j=!1;if(Y===void 0||Y!=="0"&&Y!=="1")j=!0;else W.open=Y,x.value=Y;if(v===null||v!=="0"&&v!=="1")j=!0;else W.focusTabs=v,u.value=v;if(j)chrome.storage.local.set(W)});chrome.tabs.query({active:!0,currentWindow:!0},function(_){p=_[0]});chrome.history.search(X,b);
