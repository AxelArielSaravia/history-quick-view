var o=function(v){return U.href=chrome.runtime.getURL("/_favicon/"),U.searchParams.set("pageUrl",v),U.searchParams.set("size","16"),U.toString()},O=function(v){const q=g.content.cloneNode(!0).firstElementChild,G=q.firstElementChild,z=G.firstElementChild,J=H.format(v);z.textContent=J;const W=G.lastElementChild;if(P.mode==="d")W.title=`Remove all browsing history form ${J}`,W.setAttribute("data-range",String(v)),W.appendChild(c.content.cloneNode(!0));else W.setAttribute("data-display","0");return q},D=function(v,_){var q=s.content.cloneNode(!0),G=q.firstElementChild;G.href=v.url,G.title=v.title+"\n"+v.url;var z=G.children,J=z[0];J.src=o(v.url);var W=z[1];if(v.title==="")W.textContent=v.url;else W.textContent=v.title;var N=z[2],V=N.firstElementChild;V.setAttribute("data-url",v.url),V.setAttribute("data-range",String(_)),V.appendChild(c.content.cloneNode(!0));var h=N.lastElementChild;return h.textContent=l.format(v.lastVisitTime),G},p=function(v){if(v.length<1||v.length===1&&v[0].id===P.lastItemId){console.info("No more History"),P.historyFinished=!0,w.setAttribute("data-display","0");return}var _,q;if(j.length>0)_=$.lastElementChild,A.appendChild(_),q=j.getIndex(Q.start);var G,z=0;if(v[0].id===P.lastItemId)z=1;while(z<v.length){var J=v[z];if(G=J.lastVisitTime,Q.start>G)Q.update(G),q=j.set(Q.end,Q.start),_=O(Q.start),A.appendChild(_);P.lastItemId=J.id,P.totalItems+=1,j.addCount(q);const W=D(J,Q.start);_.appendChild(W),z+=1}if(G!==void 0)Y.endTime=G,$.appendChild(A);w.setAttribute("data-display","0")},F=function(v){if(p(v),P.totalItems<1){b.setAttribute("data-display","1");return}b.setAttribute("data-display","0")},E=function(){if(P.totalItems<1){b.setAttribute("data-display","1");return}if(!P.historyFinished&&$.clientHeight===$.scrollHeight)chrome.history.search(Y,F)},i=function(v,_){if(v==="h-item"){const q=_.getAttribute("data-url"),G=_.getAttribute("data-range");if(q===null||G===null)return;const z=_.parentElement.parentElement;C.url=q,chrome.history.deleteUrl(C);const J=j.getIndex(Number(G));if(J<0)return;if(j.subtractCount(J),j.count[J]<1)z.parentElement.remove(),j.remove(J);else z.remove();P.totalItems-=1,E()}else if(v==="h-date"){const q=_.getAttribute("data-range");if(q===null)return;const G=j.getIndex(Number(q));if(G<0)return;let z=j.end[G],J=j.start[G],W=j.count[G];P.totalItems-=W,B.endTime=z,B.startTime=J,chrome.history.deleteRange(B),_.parentElement.parentElement.remove(),j.remove(G),E()}},r=function(v){if(P.historyFinished)return;const _=v.currentTarget;if(_.scrollTop===_.scrollHeight-_.clientHeight)w.setAttribute("data-display","1"),chrome.history.search(Y,p)},n=function(v){Y.text=v.value,Y.endTime=Date.now(),w.setAttribute("data-display","1"),P.reset(),j.reset(),Q.reset(),$.replaceChildren(),chrome.history.search(Y,F),k=void 0},R=function(){if(K.value.length===0)L.setAttribute("data-display","0"),P.mode="d";else L.setAttribute("data-display","1"),P.mode="s";if(k!==void 0)clearTimeout(k);k=setTimeout(n,500,K),w.setAttribute("data-display","1")},T=function(v,_){if(Z.url=v,Z.active=X.focusTabs!=="0",X.open==="0"===!_)chrome.tabs.update(d.id,Z);else chrome.tabs.create(Z)};var l=Intl.DateTimeFormat(void 0,{timeStyle:"short"}),H=Intl.DateTimeFormat(void 0,{dateStyle:"full"}),$=document.getElementById("h-container"),K=document.getElementById("h-input-search"),L=document.getElementById("h-button-search"),I=document.getElementById("h-button-history"),M=document.getElementById("h-button-clean"),m=document.getElementById("h-button-more"),b=document.getElementById("h-no-history"),w=document.getElementById("h-loading"),y=document.getElementById("h-modal"),x=document.getElementById("h-config-open"),u=document.getElementById("h-config-focus"),s=document.getElementById("template_h-item"),g=document.getElementById("template_h-range"),c=document.getElementById("template_h-delete-icon"),A=document.createDocumentFragment(),S={indexOf(v,_){var q=v.length;if(q<5)return v.indexOf(_);var G=0,z=0,J=0;while(G<q)if(z=G+Math.floor((q-G)/2),J=v[z],_===J)return z;else if(J<_)q=z;else G=z+1;return-1}},X={focusTabs:"0",open:"0"},P={MIN_SEARCH_RESULTS:30,lastItemId:"",totalItems:0,historyFinished:!1,mode:"d",reset(){P.lastItemId="",P.totalItems=0,P.historyFinished=!1}},d=void 0,Y={text:"",maxResults:P.MIN_SEARCH_RESULTS,startTime:0,endTime:Date.now()},Q={OFFSET:60000*(new Date()).getTimezoneOffset(),start:Y.endTime,end:Y.endTime,update(v){Q.end=Q.start,Q.start=v-(v-Q.OFFSET)%86400000},reset(){var v=Date.now();Q.end=v,Q.start=v}},j={end:[],start:[],count:[],length:0,addCount(v){const _=j.count;if(v<0||_.length<=v)return!1;return _[v]+=1,!0},getIndex(v){return S.indexOf(j.start,v)},remove(v){var _=j.length;if(v<0||_<=v)return!1;return j.end.copyWithin(v,v+1,_),j.end.pop(),j.start.copyWithin(v,v+1,_),j.start.pop(),j.count.copyWithin(v,v+1,_),j.count.pop(),j.length-=1,!0},reset(){j.end.length=0,j.start.length=0,j.count.length=0,j.length=0},set(v,_){return j.end.push(v),j.start.push(_),j.count.push(0),j.length+=1,j.length-1},subtractCount(v){const _=j.count;if(v<0||_.length<=v)return!1;if(_[v]>0)_[v]-=1;return!0}},U=new URL("http://t.i"),C={url:""},B={endTime:0,startTime:0},k=void 0,Z={active:!1,url:""};K.oninput=R;L.onclick=function(){K.value="",R()};var f=!1;m.onclick=function(){if(f)y.setAttribute("data-display","0");else y.setAttribute("data-display","1");f=!f};x.onchange=function(v){var _=v.currentTarget;X.open=_.value,chrome.storage.local.set(X)};u.onchange=function(v){var _=v.currentTarget;X.focusTabs=_.value,chrome.storage.local.set(X)};$.onscroll=r;M.onclick=function(){Z.url="chrome://settings/clearBrowserData",Z.active=!0,chrome.tabs.create(Z)};I.onclick=function(){T("chrome://history",!1)};$.onclick=function(v){var _=v.target,q=_.getAttribute("data-class");if(q==="h-remove"||_.matches("[data-class=h-remove] *")){const G=_.closest("[data-class=h-remove]"),z=G.getAttribute("data-type");i(z,G),v.preventDefault();return}if(q==="h-item"||_.matches("[data-class=h-item] *")){if(!v.shiftKey){const z=_.closest("[data-class=h-item]").href;T(z,v.ctrlKey),v.preventDefault()}}};chrome.storage.local.get(void 0,function(v){var{open:_,focusTabs:q}=v,G=!1;if(_===void 0||_!=="0"&&_!=="1")G=!0;else X.open=_,x.value=_;if(q===null||q!=="0"&&q!=="1")G=!0;else X.focusTabs=q,u.value=q;if(G)chrome.storage.local.set(X)});chrome.tabs.query({active:!0,currentWindow:!0},function(v){d=v[0]});chrome.history.search(Y,F);
